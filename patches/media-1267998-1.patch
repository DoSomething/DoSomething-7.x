From d182bd20acae138cd4df176294e71c14de1d7416 Mon Sep 17 00:00:00 2001
From: Tim Plunkett <git@plnktt.com>
Date: Fri, 2 Sep 2011 13:03:06 -0400
Subject: [PATCH] Issue #1267998 by tim.plunkett: Provide a Media component for Webform.

---
 modules/media_webform/components/media.inc |   72 ++++++++++++++++++++++++++++
 modules/media_webform/media_webform.info   |    6 ++
 modules/media_webform/media_webform.module |   25 ++++++++++
 3 files changed, 103 insertions(+), 0 deletions(-)
 create mode 100644 modules/media_webform/components/media.inc
 create mode 100644 modules/media_webform/media_webform.info
 create mode 100644 modules/media_webform/media_webform.module

diff --git a/modules/media_webform/components/media.inc b/modules/media_webform/components/media.inc
new file mode 100644
index 0000000..bdd0ae6
--- /dev/null
+++ b/modules/media_webform/components/media.inc
@@ -0,0 +1,72 @@
+<?php
+
+/**
+ * @file
+ * Media component for Webform.
+ */
+
+/**
+ * Implements _webform_defaults_component().
+ */
+function _webform_defaults_media() {
+  return array(
+    'name' => '',
+    'form_key' => NULL,
+    'mandatory' => 0,
+    'pid' => 0,
+    'weight' => 0,
+    'extra' => array(
+      'allowed_types' => array(),
+      'allowed_schemes' => array(),
+    ),
+  );
+}
+
+/**
+ * Implements _webform_edit_component().
+ */
+function _webform_edit_media($component) {
+  $instance = array('widget' => array('settings' => $component['extra']));
+  $form['extra'] = media_field_widget_settings_form(NULL, $instance);
+  return $form;
+}
+
+/**
+ * Implements _webform_render_component().
+ */
+function _webform_render_media($component, $value = NULL, $filter = TRUE) {
+  $form = array();
+  $form_state = array();
+  $instance = array('widget' => array('settings' => $component['extra']));
+
+  $element = array(
+    'media' => media_field_widget_form($form, $form_state, NULL, $instance, NULL, NULL, NULL, array()),
+    '#webform_component' => $component,
+    '#weight' => $component['weight'],
+    '#title' => $filter ? _webform_filter_xss($component['name']) : $component['name'],
+    '#title_display' => $component['extra']['title_display'] ? $component['extra']['title_display'] : 'before',
+    '#description' => $filter ? _webform_filter_descriptions($component['extra']['description']) : $component['extra']['description'],
+    '#theme_wrappers' => array('webform_element'),
+  );
+
+  if ($component['mandatory']) {
+    $element['#required'] = TRUE;
+  }
+
+  return $element;
+}
+
+/**
+ * Implements _webform_submit_component().
+ */
+function _webform_submit_media($component, $value) {
+  return isset($value['media']) ? $value['media'] : NULL;
+}
+
+/**
+ * Implements _webform_display_component().
+ */
+function _webform_display_media($component, $value, $format = 'html') {
+  $fid = isset($value['fid']) ? $value['fid'] : NULL;
+  return file_view(file_load($fid));
+}
diff --git a/modules/media_webform/media_webform.info b/modules/media_webform/media_webform.info
new file mode 100644
index 0000000..0259913
--- /dev/null
+++ b/modules/media_webform/media_webform.info
@@ -0,0 +1,6 @@
+name = Media Webform
+description = Provides a Media component for Webform.
+core = 7.x
+package = Media
+dependencies[] = media
+dependencies[] = webform
diff --git a/modules/media_webform/media_webform.module b/modules/media_webform/media_webform.module
new file mode 100644
index 0000000..d3781e9
--- /dev/null
+++ b/modules/media_webform/media_webform.module
@@ -0,0 +1,25 @@
+<?php
+
+/**
+ * @file
+ * Provides a Media component for Webform.
+ */
+
+/**
+ * Implements hook_webform_component_info().
+ */
+function media_webform_webform_component_info() {
+  $components = array();
+
+  $components['media'] = array(
+    'label' => t('Media'),
+    'description' => t('Media fields allow third-party media to be displayed.'),
+    'features' => array(
+      'required' => FALSE,
+      'conditional' => FALSE,
+    ),
+    'file' => 'components/media.inc',
+  );
+
+  return $components;
+}
-- 
1.7.0.4

