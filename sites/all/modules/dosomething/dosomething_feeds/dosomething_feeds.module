<?php

function dosomething_feeds_menu() {
  $items = array();
  $items['news/feed'] = array(
    'title' => 'DoSomething.org News Feed',
    'page callback' => 'dosomething_feeds_news',
    'access callback' => TRUE,
    'description' => 'DoSomething.org News',
    'type' => MENU_CALLBACK,
    'page arguments' => array($type => 'chatterbox', 'title' => 'DoSomething.org News Feed', 'description' => 'The DoSomething.org News Box'),
  );
  $items['cgg/rss'] = array(
    'title' => 'Celebs Gone Good',
    'page callback' => 'dosomething_feeds_news',
    'access callback' => TRUE,
    'description' => 'News on the latest Celebs Gone Good',
    'type' => MENU_CALLBACK,
    'page arguments' => array('type' => 'celebs_gone_good', 'title' => 'Celebs Gone Good', 'description' => 'News on the latest Celebs Gone Good'),
  );
  return $items;
}

function dosomething_feeds_theme() {
  return array(
    'dosomething_feed' => array(
      'template' => 'feeds',
      'path' => drupal_get_path('module', 'dosomething_feeds'), 
      'variables' => array(
        'data' => NULL,
        'items' => NULL
      ),
    ),
    'dosomething_feed_item' => array(
      'template' => 'feeds-item',
      'path' => drupal_get_path('module', 'dosomething_feeds'),
      'variables' => array(
        'item' => NULL,
        'data' => NULL,
      ),
    ),
  );
}
  
function dosomething_feeds_news($type, $title, $description) {
  drupal_add_http_header('Content-Type: text/xml; charset=utf-8');
  module_load_include('inc', 'dosomething_feeds', 'dosomething_feeds_get_view');
  $view = dosomething_feeds_get_view($type);
  $view->execute();
  $results = $view->result;
  $output = array(
    '#theme' => 'dosomething_feed',
    '#data' => $view,
    '#title' => $title,
    '#description' => $description,
  );
  foreach ($results as $result) {
    $output['#items'][] = theme('dosomething_feed_item', array('item' => $result));
  }
  return $output;
}

