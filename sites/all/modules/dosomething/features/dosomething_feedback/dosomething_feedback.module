<?php
/**
 * @file
 * Code for the dosomething_feedback feature.
 */

include_once('dosomething_feedback.features.inc');

/**
 * Default the name field to use the user name.
 */
function dosomething_feedback_form_feedback_form_alter(&$form, $form_state) {
  global $user;
  if ($user->uid) {
    $form['field_name'][LANGUAGE_NONE][0]['value']['#default_value'] = $user->name;
  }
}

/**
 * Implements hook_unfuddle_feedback_fields_alter().
 */
function dosomething_feedback_unfuddle_feedback_fields_alter(&$fields, $entry) {
  if (isset($entry->field_priority[LANGUAGE_NONE][0]['value'])) {
    switch($entry->field_priority[LANGUAGE_NONE][0]['value']) {
      case 'Critical':
        $fields['priority'] = 5;
        break;
      case 'High':
        $fields['priority'] = 4;
        break;
      case 'Medium':
        $fields['priority'] = 3;
        break;
      case 'Low':
        $fields['priority'] = 2;
        break;
      case 'Enhancement':
        $fields['priority'] = 1;
        break;
    }
  }
  $fields['description-format'] = 'plain';
  $fields['assignee-id'] = 48329;
  $fields['milestone-id'] = 357;
}

/**
 * Implements hook_unfuddle_feedback_subject_alter().
 */
function dosomething_feedback_unfuddle_feedback_subject_alter(&$subject, $entry) {
  $subject = $entry->location;
  $subject .= ' (' . check_plain($entry->field_name[LANGUAGE_NONE][0]['value']) . ')';
}