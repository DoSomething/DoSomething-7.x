<?php

/**
 * @file
 * dosomething_modal.module
 **/

/**
 * Implements hook_menu().
 */
function dosomething_modal_menu() {
  $items['dosomething-modal-test'] = array(
    'title' => 'DoSomething Modal Test Page',
    'page callback' => 'dosomething_modal_test_page',
    'access arguments' => array('administer modules'),
    'type' => MENU_CALLBACK,
  );
  $items['ds-modal/%ctools_js/form/%'] = array(
    'title' => 'DoSomething',
    'page callback' => 'dosomething_modal_form_builder_callback',
    'page arguments' => array(1, 3),
    'access callback' => TRUE,
    'type' => MENU_CALLBACK,
  );
  return $items;
}

/**
 * The modal callback for the school form.
 */
function dosomething_modal_form_builder_callback($ajax, $form_id) {
  if ($ajax) {
    ctools_include('ajax');
    ctools_include('modal');
 
    $form_state = array(
      'ajax' => TRUE,
      'title' => t('To Be Dynamic'),
    );
 
    // Use ctools to generate ajax instructions for the browser to create
    // a form in a modal popup.
    $output = ctools_modal_form_wrapper($form_id, $form_state);
 
    // If the form has been submitted, there may be additional instructions
    // such as dismissing the modal popup.
    if (!empty($form_state['ajax_commands'])) {
      $output = $form_state['ajax_commands'];
    }
 
    // Return the ajax instructions to the browser via ajax_render().
    print ajax_render($output);
    drupal_exit();
  }
  else {
    return drupal_get_form($form_id);
  }
}

/**
 * Callback for test modal page.
 */
function dosomething_modal_test_page() {
  // Include necessary CTools stuff:
  ctools_include('ajax');
  ctools_include('modal');
  ctools_modal_add_js();

  // Create our own javascript that will be used to theme a modal.
  $ds_style = array(
    'ctools-sample-style' => array(
      'modalSize' => array(
        'type' => 'fixed',
        'width' => 400,
        'height' => 300,
        'addWidth' => 20,
        'addHeight' => 15,
      ),
      'modalOptions' => array(
        'opacity' => .5,
        'background-color' => '#000',
      ),
      'animation' => 'fadeIn',
      'modalTheme' => 'CToolsSampleModal',
      'throbber' => theme('image', array('path' => ctools_image_path('ajax-loader.gif', 'ctools_ajax_sample'), 'alt' => t('Loading...'), 'title' => t('Loading'))),
    ),
  );

  drupal_add_js($ds_style, 'setting');

  // From ctools ajax sample module:
  ctools_add_js('ctools-ajax-sample', 'ctools_ajax_sample');
  //ctools_add_css('ctools-ajax-sample', 'ctools_ajax_sample');
  $links[] = ctools_modal_text_button(t('Click Me'), 'ds-modal/nojs/form/dosomething_user_school_form', t('Click me'), 'ctools-modal-ctools-sample-style');
  $output = theme('item_list', array('items' => $links, 'title' => t('Testing')));
  // This container will have data AJAXed into it.
  $output .= '<div id="ctools-sample"></div>';
  return array('markup' => array('#markup' => $output));
}
