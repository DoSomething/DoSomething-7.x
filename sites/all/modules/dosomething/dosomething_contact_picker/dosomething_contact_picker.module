<?php

/**
 * Implements hook_menu()
 */
function dosomething_contact_picker_menu() {
  $items['contact-picker/%'] = array(
  	'page callback' => 'dosomething_contact_picker_portal',
  	'page arguments' => array(1),
  	'access callback' => TRUE,
  );

  $items['contact-picker/service/%'] = array(
    'page callback' => 'dosomething_contact_picker_load_service',
    'page arguments' => array(2),
    'access callback' => TRUE,
    'file' => 'dosomething_contact_picker.services.inc',
  );

  $items['contact-picker/invite/%'] = array(
    'page callback' => 'dosomething_contact_picker_invite_emails',
    'page arguments' => array(2),
    'access callback' => TRUE,
  );

  return $items;
}

/**
 * Implements hook_library().
 */
function dosomething_contact_picker_library() {
  $libraries = array();

  $path = drupal_get_path('module', 'dosomething_contact_picker');
  $libraries['contact_picker'] = array(
  	'title' => 'DoSomething Contact Picker',
  	'version' => '2.0',
  	'js' => array(
  		$path . '/js/dosomething_contact_picker.js' => array(),
  	),
  	'css' => array(
  		$path . '/css/dosomething_contact_picker.css' => array(),
  	),
  );

  return $libraries;
}

/**
 * Builds the portal for the contact picker.
 */
function dosomething_contact_picker_portal($nid) {
  $node = menu_get_object('node', 1, 'node/' . $nid);
  if (!isset($node->nid)) {
  	return;
  }

  if ($path = libraries_get_path('SearchApiService')) {
  	require_once $path . '/service.php';
  }

  echo theme('contact_picker_portal', array(
    'nid' => $nid,
  ));
  drupal_exit();
}

/**
 * Invites emails.
 */
function dosomething_contact_picker_invite_emails($nid) {
  echo '<pre>', print_r($_POST), '</pre>';
  exit;
}

/**
 * Implements hook_theme()
 */
function dosomething_contact_picker_theme($existing, $type, $theme, $path) {
  return array(
    'contact_picker_portal' => array(
      'path' => $path . '/templates',
      'variables' => array(),
      'template' => 'contact-scraper-landing',
    ),
    'contact_picker_contacts' => array(
      'path' => $path . '/templates',
      'variable' => array(
        'contacts' => NULL,
      ),
      'template' => 'contact-picker-contacts',
    ),
  );
}